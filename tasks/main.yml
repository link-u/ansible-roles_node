---
# tasks/main.yml (node)
# Prefix : node

- name: Check node is installed
  become: yes
  stat:
    path: "{{ node_bin_path }}"
  register: bin_node

- name: Install nodejs
  become: yes
  when: not bin_node.stat.exists
  block:
    - name: Install standard nodejs and npm
      apt:
        name: ["nodejs", "npm"]
        state: present
        update_cache: yes

    - name: Clean cache
      shell: "npm cache verify  &&  npm install --cache /tmp/empty-cache"

    - name: Install n on global
      shell: npm install -g n

    - name: Install specific version node
      shell: "n {{ node_install_version }}"

    - name: Remove old node and npm
      apt:
        name: ["nodejs", "npm"]
        purge: yes
        state: absent
